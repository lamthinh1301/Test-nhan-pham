<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>VÃ²ng Quay NhÃ¢n Pháº©m</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      background: #f3f3f3;
    }
    h1 {
      color: #4a148c;
    }
    input, button {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
    }
    #result, #admin-panel, #leaderboard {
      margin-top: 20px;
      padding: 15px;
      background: #ffffff;
      border-radius: 8px;
      display: none;
    }
    table {
      margin: 0 auto;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
    }
  </style>
</head>
<body>

  <h1>ğŸ¯ VÃ²ng Quay NhÃ¢n Pháº©m ğŸ¯</h1>

  <input type="text" id="nameInput" placeholder="Nháº­p tÃªn cá»§a báº¡n" />
  <button onclick="play()">Quay Ä‘iá»ƒm</button>

  <div id="result"></div>

  <hr>
  <div>
    <input type="password" id="adminCode" placeholder="Nháº­p mÃ£ admin (12344321)" />
    <button onclick="loginAdmin()">ÄÄƒng nháº­p Admin</button>
  </div>

  <div id="admin-panel">
    <h2>ğŸ” Báº£ng Quáº£n LÃ½ Admin</h2>
    <button onclick="revealAll()">ğŸ“¢ CÃ´ng bá»‘ Ä‘iá»ƒm</button>
    <button onclick="resetAll()">ğŸ”„ Reset toÃ n bá»™</button>
    <br><br>
    <input type="text" id="resetOneName" placeholder="TÃªn ngÆ°á»i cáº§n reset" />
    <button onclick="resetOne()">Reset ngÆ°á»i nÃ y</button>
  </div>

  <div id="leaderboard">
    <h2>ğŸ† Báº£ng xáº¿p háº¡ng</h2>
    <table id="rankTable">
      <tr><th>STT</th><th>TÃªn</th><th>Äiá»ƒm</th></tr>
    </table>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbwXY66kDQld99FREk9EaWcjk5FKUuriEi6N3X3b_u_o1Fg4MrylwDt802pn8_N3_JL2dg/exec";
    let currentUser = "";

    function play() {
      const name = document.getElementById("nameInput").value.trim();
      if (!name) return alert("Vui lÃ²ng nháº­p tÃªn");
      currentUser = name;
      fetch(`${scriptURL}?action=play&name=${encodeURIComponent(name)}`)
        .then(res => res.json())
        .then(data => {
          if (data.status === "exists") {
            document.getElementById("result").innerHTML = `Báº¡n Ä‘Ã£ quay rá»“i! Äiá»ƒm cá»§a báº¡n lÃ : <strong>${data.score}</strong>`;
          } else {
            document.getElementById("result").innerHTML = `Báº¡n vá»«a quay Ä‘Æ°á»£c: <strong>${data.score}</strong>`;
          }
          document.getElementById("result").style.display = "block";
          loadLeaderboard(false);
        });
    }

    function loginAdmin() {
      const code = document.getElementById("adminCode").value;
      if (code === "12344321") {
        document.getElementById("admin-panel").style.display = "block";
        loadLeaderboard(true);
      } else {
        alert("Sai mÃ£ admin");
      }
    }

    function revealAll() {
      loadLeaderboard(true);
      document.getElementById("leaderboard").style.display = "block";
    }

    function resetAll() {
      if (!confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n reset toÃ n bá»™ khÃ´ng?")) return;
      fetch(`${scriptURL}?action=resetAll`)
        .then(() => {
          alert("ÄÃ£ reset toÃ n bá»™!");
          location.reload();
        });
    }

    function resetOne() {
      const name = document.getElementById("resetOneName").value.trim();
      if (!name) return alert("Nháº­p tÃªn ngÆ°á»i cáº§n reset");
      fetch(`${scriptURL}?action=resetOne&name=${encodeURIComponent(name)}`)
        .then(res => res.text())
        .then(text => {
          if (text.includes("done")) {
            alert(`ÄÃ£ reset: ${name}`);
            loadLeaderboard(true);
          } else {
            alert("KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i nÃ y.");
          }
        });
    }

    function loadLeaderboard(showAll) {
      fetch(`${scriptURL}?action=get`)
        .then(res => res.json())
        .then(data => {
          const table = document.getElementById("rankTable");
          table.innerHTML = "<tr><th>STT</th><th>TÃªn</th><th>Äiá»ƒm</th></tr>";
          let sorted = data.sort((a, b) => b.score - a.score);
          sorted.forEach((row, index) => {
            let score = (showAll || row.name === currentUser) ? row.score : '***';
            const tr = `<tr><td>${index + 1}</td><td>${row.name}</td><td>${score}</td></tr>`;
            table.innerHTML += tr;
          });
          if (showAll) {
            document.getElementById("leaderboard").style.display = "block";
          }
        });
    }
  </script>

</body>
</html>
